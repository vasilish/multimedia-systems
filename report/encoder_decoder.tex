\chapter{Ολοκληρωμένο σύστημα κωδικοποιητή \& αποκωδικοποιητή}

\par Έχοντας ολοκληρώσει όλα τα επιμέρου συστήματα που αποτελούν ένα κωδικοποιητή 
αποκωδικοποιητη, τώρα πρέπει να τα συνδέσουμε όλα μεταξύ τους, ώστε να τον συνθέσουμε. 
Αρχικά παρουσιάζουμε τη διαδικασία που ακολουθήθηκε για την δημιουργία 
του κωδικοποιητή.
\section{Ολοκληρωμένος Κωδικοποιητής}
\par Παρακάτω παρουσιάζονται όλα τα βήματα που χρησιμοποιήσαμε για την σύνθεση ενός 
κωδικοποιητή και στη συνέχεια τα θα αναλύσουμε το κάθε ένα από αυτά.
\begin{enumerate}
\item Υποδειγματοληψία του αρχικού σήματος.
\item Χωρισμός του σήματος σε παράθυρα καθορισμένου μήκους.
\item Υπολογισμός των παραμέτρων του γραμμικού προβλέπτη.
\item Χρήση του συστήματος adpcm
\item Υπολογισμός μετασχηματισμού Huffman
\item Εγγραφή των παραμέτρων σε διαδυκή μορφή σε αρχείο
\end{enumerate}

\subsection{Υποδειγματοληψία}
\par Το πρώτο πράγμα που θα κάνουμε είναι να μετατρέψουμε το σήμα που έχουμε 
σε δειγματοληψία χαμηλότερης συχνότητας. Αυτό θα έχει σαν αποτέλεσμα να χρησιμοποιήσουμε
λιγότερα δείγματα για την κωδικοποίηση, καθώς η υποδειγματοληψία μειώνει το μήκος 
του αρχικού σήματος, όπως αναφέραμε και στην αρχή. Για την υποδειγματοληψία θα χρησιμοποιηθεί 
η συνάρτηση changefs.

\subsection{Δημιουργία παραθύρων}
\par Επειδή το δείγμα μας είναι πολύ μεγάλο είναι αναγκαίο να το χωρίσουμε 
σε μικρότερα ανεξάρτητα παράθυρα και να τα κωδικοποιήσουμε ανεξάρτητα το ένα από 
το άλλο. Στη συνέχεια για καθε δείγμα καλούμε τη συνάρτηση 
\begin{lstlisting}[style=MyMatlab]
 function [b, newstate] = encoder(x, state)
\end{lstlisting}
όπου x είναι το εκάστοτε παράθυρο και b η κωδικοποίηση του. 

\subsection{Υπολογισμός παραμέτρων γραμμικού προβλέπτη}
\par Μέσα στη συνάρτηση encoder θέλουμε να δημιουργήσουμε ένα γραμμικό προβλέπτη για 
κάθε παράθυρο. Αυτό το κάνουμε με τη χρήση της συνάρτησης lpcoeffs όπως αναφέραμε και 
παραπάνω.

\subsection{Χρήση Adpcm}
\par Στο σημείο αυτό θέλουμε να χρησιμοποιήσουμε την μέθοδο adpcm ώστε να μπορέσουμε 
να έχουμε τη δυνατότερη μικρή κωδικοποίηση. Για την χρήση όμως του adpcm είναι 
απαραίτητη η ύπαρξη ενός κβαντιστή. Άρα σε πρώτη φάση δημιουργούμε έναν ομοιόμορφο 
κβαντιστή γιατί χρειαζόμαστε τις στάθμες απόφασης και κβαντισμού. Στη συνέχεια 
χρησιμοποιούμε την συνάρτηση adpcm και υπολογίζουμε τα σύμβολα τόσο για το σήμα, 
όσο και για τις παραμέτρους του γραμμικού προβλέπτη.

\subsection{Χρήση μετασχηματισμού Huffman}
\par Αφού υπολογίσαμε τα σύμβολα τα οποία αναπαριστούν το σήμα μας, θα τα 
κωδικοποιήσουμε με τη χρήση του μετασχηματισμού huffman. Πρώτα είναι, όμως, 
απαραίτητο να προσδιορίσουμε τη συχνότητα εμφάνισης του κάθε συμβόλου. Μόλις 
γίνει πρώτα υπολογίζουμε το κώδικα Huffman κάθε συμβόλου με τη συνάρτηση huffLUT 
και στη συνέχεια υπολογίζουμε το μετασχηματισμό huffman του παραθύρου με τη συνάρτηση 
huff.

\subsection{Δημιουργία Bitstream}
\par Η διαδικασία που περιγράφτηκε παραπάνω είναι η κωδικοποίηση που γίνεται. Το 
μόνο που μένει είναι να δημιουργήσουμε ένα bitstream που αποτελείται μόνο από 0 
και 1. Κάθε παράθυρο έχει δικό του bitstream. Καθώς εκτελείται η όλη διαδικασία 
που αναφέρθηκε παραπάνω έχουμε την μεταβλητή counter, η οποία μας μετράει πόσα 
bits θα καταλάβει η κωδικοποίηση του παραθύρου. Αυτό είναι το πρώτο κομμάτι του bitstream 
σε δυαδική μορφή σε 24 bits και είναι απαραίτητη ώστε να μπορέσουμε να ξεχωρίσουμε 
καθε bitstream για κάθε ένα από τα παράθυρα. Στη συνέχεια αποθηκεύουμε τον κώδικα huffman 
με 4bits μπροστά από κάθε κωδικολέξη τα οποία προσδιορίζουν το μηκός της. Στη συνέχεια 
αποθηκεύουμε το ελάχιστο και το μέγιστο στοιχείο κάθε παραθύρου με μήκος 32bits το καθένα, ώστε να 
μπορέσουμε να αναχτήσουμε τον κβαντιστή κατά τη διάρκεια της αποκωδικοποίησης. Ακόμα 
αποθηκεύουμε τον ελάχιστο και τον μέγιστο συντελεστή πρόβλεψης οι οποίοι θα μας χρειαστούν 
στην ανάστροφη διαδικασία adpcm. Τέλος αποθηκεύουμε και την κωδικοποίηση Huffman του 
παραθύρου.

\subsection{Η συνάρτηση myEncoder}
\par Η κύρια συνάρτηση που ξεκινάει την κωδικοποιήση είναι η 
\begin{lstlisting}[style=MyMatlab]
 function myEncoder(wavFilename, codedFilaneme)
\end{lstlisting}
, όπου wavFilenameσ


